"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)}function getWikiPageId(e){var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?action=query&format=json&titles="+e+"&formatversion=2&origin=*",n=new Headers;return n.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:n}).then(function(e){if(e.ok)return e.json();throw new Error("Error while retrieving page with id "+pageId)}).then(function(e){if(e.error)throw console.warn(e.error.info),{code:e.error.code,message:e.error.info};return e.query.pages[0].pageid}).catch(function(e){return Promise.reject(e)})}function resolveLink(e){var r=new RegExp(/.*\/(.+)$/,"g").exec(e)[0];return console.log(r),getWikiPageId(r).then(function(e){return e})}function showPage(e,r){var n=navigator.language||navigator.userLanguage;r.innerHTML=e.parse.text["*"]||e.parse.text;for(var t=document.querySelectorAll("a"),a=0,o=t.length;a<o;a++)/wiki|w/g.test(t[a].pathname)&&(t[a].host=n+".wikipedia.org",t[a].port=443)}function getWikiPage(e){var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?action=parse&format=json&formatversion=2&pageid="+e+"&origin=*",n=new Headers;n.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:n}).then(function(r){if(r.ok)return r.json();throw new Error("Error while retrieving page with id "+e)}).then(function(e){if(e.error)throw console.warn(e.error.info),{code:e.error.code,message:e.error.info};showPage(e,document.querySelector(".external__data"))}).catch(function(e){return console.error((e.code||"")+" "+e.message+" "+e.stack+")")})}function slideIn(e){if(e.childNodes){var r=[],n=[],t=[];return e.childNodes.forEach(function(e,a,o){e.classList.contains("--slide-from-top")?t[a]=new Promise(function(r,t){var o=setTimeout(function(){clearTimeout(n.shift()),e.classList.remove("--slide-from-top"),r("Ok")},30*a);n.push(o)}):t[a]=new Promise(function(n,t){var i=setTimeout(function(){clearTimeout(r.pop()),e.classList.add("--slide-to-bottom");var t=setTimeout(function(){clearTimeout(t),e.classList.remove("--slide-to-bottom")},300);n("Ok")},10*(o.length-a));r.push(i)})}),t}}function showData(e,r){var n=e.pageid,t=e.title,a=document.createElement("div"),o=document.createElement("h2");o.innerHTML=t,o.classList.add("media-box__title"),a.appendChild(o);var i=document.createElement("div");if(e.thumbnail){var c=e.thumbnail.source,s=e.thumbnail.width,d=e.thumbnail.height,l=document.createElement("img");l.src=c,l.height=d,l.width=s,l.classList.add("media-box__image"),i.appendChild(l)}if(e.terms){var u=e.terms.description[0],h=document.createElement("p");h.innerHTML=u,h.classList.add("media-box__text"),i.appendChild(h)}a.classList.add("media-box"),a.classList.add("--slide-from-top"),i.classList.add("media-box__container"),a.appendChild(i),r.appendChild(a),a.addEventListener("click",function(){getWikiPage(n)})}function searchWikiData(e){var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?\n      action=query&\n      format=json&\n      generator=prefixsearch&\n      prop=pageprops%7Cpageimages%7Cpageterms&\n      redirects=&\n      ppprop=displaytitle&\n      piprop=thumbnail&\n      pithumbsize=80&\n      pilimit=6&\n      wbptterms=description&\n      gpssearch="+e+"&\n      gpsnamespace=0&\n      gpslimit=6&\n      origin=*",n=new Headers;return n.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:n}).then(function(r){if(console.log("fetched data for cycle="+cycle),r.ok)return r.json();throw new Error("Could not get the Wikipage for "+e+"!")}).then(function(r){if(r.error)throw console.warn(r.error.info),new Error({code:r.error.code,message:r.error.info});if(r.query&&r.query.pages)return r.query.pages||r.query.search;throw console.warn(r.query),new Error({code:"NoSuchPage",message:"There is no pages for "+e})}).catch(function(e){return Promise.reject(e)})}function clearData(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function cleanInput(e){return e.replace(/([.,;:=+[\]\\|\/?<>!@#$%\^\&*()'"\n\r])/g,"")}function searchPhrase(){var e=cleanInput(inputElm.value);Promise.all([searchWikiData(e)].concat(_toConsumableArray(slideIn(dataElm)))).then(function(e){return clearData(dataElm),e[0]}).then(function(e){Object.keys(e).forEach(function(r){showData(e[r],dataElm)})}).then(function(){console.log("Second slideIn inside searchWikiData for cycle="+cycle),slideIn(dataElm)})}function searchRandom(){}function delayMethod(e,r,n){void 0===window.delayMethod&&(window.delayMethod={}),delayMethod[e]=Date.now(),console.log(""+delayMethod[e]);var t=delayMethod[e];setTimeout(function(){delayMethod[e]===t&&r()},n||500)}function debounce(e,r){var n=this,t=arguments,a=void 0;return function(){var o=n,i=t;clearTimeout(a),a=setTimeout(function(){a=null,e.apply(o,i)},r)}}var submitBtnElm=document.querySelector("#searchBtnSubmit"),randomBtnElm=document.querySelector("#searchBtnRandom"),inputElm=document.querySelector("#searchInput"),dataElm=document.querySelector(".external__data"),cycle=1,delayFnOnInput=debounce(searchPhrase,250,!1);submitBtnElm.addEventListener("click",searchPhrase),randomBtnElm.addEventListener("click",searchRandom),inputElm.addEventListener("keyup",function(e){console.log(e.target.value),delayFnOnInput(),cycle++});
//# sourceMappingURL=script.js.map
