"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}var localSpace=function(){function e(e){var r=e.name,t=void 0===r?"CustomError":r,n=e.message,o=void 0===n?"An error occured":n;this.name=t,this.message=o,this.stack=(new Error).stack}function r(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function t(){g.removeEventListener("keyup",t),p.classList.add("search--upper"),p.classList.remove("search--middle"),g.classList.remove("search__input--middle"),f.classList.remove("search__btn--middle"),m.classList.remove("search__btn--middle")}function n(){0===g.value.length&&r(v)}function o(e){return e.replace(/([.,;:=+[\]\\|\/?<>!@#$%\^\&*()'"\n\r])/g,"")}function a(e){var r=document.location.href,t=document.title;window.history.replaceState({searchValue:g.value,pageTitle:t},"",r),window.history.pushState({searchValue:g.value,pageTitle:t,pageId:e},"",r)}function i(e){var r=[],t=e.childNodes;return t?function(){for(var e=[],n=[],o=0,a=t.length;o<a;o++)!function(o,a){var i=t[o],s=t;i.classList.contains("--slide-from-top")?r[o]=new Promise(function(e,r){var t=setTimeout(function(){clearTimeout(n.shift()),i.classList.remove("--slide-from-top"),e("Ok")},30*o);n.push(t)}):r[o]=new Promise(function(r,t){var n=setTimeout(function(){clearTimeout(e.pop()),i.classList.add("--slide-to-bottom");var t=setTimeout(function(){clearTimeout(t),i.classList.remove("--slide-to-bottom")},300);r("Ok")},10*(s.length-o));e.push(n)})}(o)}():r=[],r}function s(e,r){r.innerHTML=e.parse.text["*"]||e.parse.text;for(var t=document.querySelectorAll("a"),n=0,o=t.length;n<o;n++)/wiki|w/g.test(t[n].pathname)&&(t[n].host=w+".wikipedia.org",t[n].port=443)}function c(r){var t="https://"+w+".wikipedia.org/w/api.php?action=parse&format=json&formatversion=2&pageid="+r+"&origin=*",n={headers:{"Api-User-Agent":"Example/1.0"}};fetch(t,n).then(function(t){if(t.ok)return t.json();throw new e({name:"HTTPError",message:"Error while retrieving page with id "+r})}).then(function(r){if(r.error)throw console.warn(r.error.info),new e({name:r.error.code,message:r.error.info});s(r,v)}).catch(function(e){return console.error((e.code||"")+" "+e.message+" "+e.stack+")")})}function u(e){var r=e.pageid,t=e.title,n=document.createElement("div"),o=document.createElement("h2");o.innerHTML=t,o.classList.add("media-box__title"),n.appendChild(o);var i=document.createElement("div");if(e.thumbnail){var s=e.thumbnail.source,u=e.thumbnail.width,l=e.thumbnail.height,d=document.createElement("img");d.src=s,d.height=l,d.width=u,d.classList.add("media-box__image"),i.appendChild(d)}if(e.terms){var h=e.terms.description[0],p=document.createElement("p");p.innerHTML=h,p.classList.add("media-box__text"),i.appendChild(p)}n.classList.add("media-box"),n.classList.add("--slide-from-top"),i.classList.add("media-box__container"),n.appendChild(i),v.appendChild(n),n.addEventListener("click",function(){a(r),c(r)})}function l(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n="https://"+w+".wikipedia.org/w/api.php?\n        action=query&\n        format=json&\n        generator=prefixsearch&\n        prop=pageprops%7Cpageimages%7Cpageterms&\n        redirects=&\n        ppprop=displaytitle&\n        piprop=thumbnail&\n        pithumbsize=80&\n        pilimit="+t+"&\n        wbptterms=description&\n        gpssearch="+r+"&\n        gpsnamespace=0&\n        gpslimit="+t+"&\n        origin=*",o={headers:{"Api-User-Agent":"Example/1.0"}};return fetch(n,o).then(function(e){if(e.ok)return e.json();throw new Error("Could not get the Wikipage for "+r+"!")}).then(function(t){if(t.error)throw console.warn(t.error.info),new e({name:t.error.code,message:t.error.info});if(t.query&&t.query.pages)return t.query.pages||t.query.search;throw console.warn("No such page"),new e({name:"NoSuchPage",message:r})}).catch(function(e){return Promise.reject(e)})}function d(e){var r="https://"+w+".wikipedia.org/wiki/Special:Search?search="+e,t="https://www.google.com/search?q="+e;v.innerHTML="<p>There is no article for <em>"+e+'</em>. Try to search with <a href="'+r+'">Wiki</a> or <a href="'+t+'">Google</a>.</p>'}function h(){var e=o(g.value);Promise.all([l(e)].concat(_toConsumableArray(i(v)))).then(function(e){return r(v),e[0]}).then(function(e){Object.keys(e).forEach(function(r){u(e[r],v)})}).then(function(){i(v)}).catch(function(e){r(v),"NoSuchPage"===e.name&&d(e.message)})}var p=document.querySelector(".search"),m=document.querySelector("#searchBtnSubmit"),f=document.querySelector("#searchBtnRandom"),g=document.querySelector("#searchInput"),v=document.querySelector(".external__data"),w=(navigator.language||navigator.userLanguage).slice(0,2),y=["Meta","Alt","CapsLock","Shift","Control","Tab","Escape","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"],k=function(e,r){for(var t=arguments.length,n=Array(t>2?t-2:0),o=2;o<t;o++)n[o-2]=arguments[o];var a=this,i=void 0;return function(){var t=a;clearTimeout(i),i=setTimeout(function(){i=null,e.apply(t,n)},r)}}(h,250,!1);[].includes||(Array.prototype.includes=function(e){var r=Object(this),t=parseInt(r.length)||0;if(0===t)return!1;var n=parseInt(arguments[1])||0,o=void 0;for(n>=0?o=n:(o=t+n)<0&&(o=0);o<t;){var a=r[o];if(e===a||e!==e&&a!==a)return!0;o+=1}return!1}),e.prototype=new Error,window.onpopstate=function(e){e.state.searchValue&&(r(v),t(),g.value=e.state.searchValue,document.title=e.state.pageTitle,e.state.pageId?c(e.state.pageId):h())},m.addEventListener("click",function(){g.length||(r(v),t(),n(),h())}),f.addEventListener("click",function(){var e="https://"+w+".wikipedia.org/w/api.php?\n        action=query&\n        format=json&\n        generator=random&\n        rnnamespace=1&\n        origin=*",r={headers:{"Api-User-Agent":"Example/1.0"}};return fetch(e,r).then(function(e){if(e.ok)return e.json();throw new Error("Could not get a random Wikipage!")}).then(function(e){if(e.error)throw console.warn(e.error.info),new Error({name:e.error.code,message:e.error.info});if(e.query&&e.query.pages)return e.query.pages;throw console.warn(e.query),new Error({name:"NoSuchPage",message:"There is no pages found"})}).then(function(e){var r=Object.keys(e)[0];t(),a(r),c(r)}).catch(function(e){return Promise.reject(e)})}),g.addEventListener("keyup",t),p.addEventListener("submit",function(e){return e.preventDefault(),!1}),g.addEventListener("keydown",function(e){("Backspace"===e.key&&e.metaKey||!g.length&&v.childNodes.length>0)&&r(v)}),g.addEventListener("keyup",function(e){y.includes(e.key)||(n(),k())})}();
//# sourceMappingURL=script.js.map
