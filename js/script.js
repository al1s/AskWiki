"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}var localSpace=function(){function e(){h.removeEventListener("keyup",e),d.classList.add("search--upper"),d.classList.remove("search--middle"),h.classList.remove("search__input--middle"),p.classList.remove("search__btn--middle")}function r(){0===h.value.length&&c(g)}function t(e,r){var t=navigator.language||navigator.userLanguage;r.innerHTML=e.parse.text["*"]||e.parse.text;for(var n=document.querySelectorAll("a"),o=0,a=n.length;o<a;o++)/wiki|w/g.test(n[o].pathname)&&(n[o].host=t+".wikipedia.org",n[o].port=443)}function n(e){var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?action=parse&format=json&formatversion=2&pageid="+e+"&origin=*",n=new Headers;n.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:n}).then(function(r){if(r.ok)return r.json();throw new Error("Error while retrieving page with id "+e)}).then(function(e){if(e.error)throw console.warn(e.error.info),new Error({code:e.error.code,message:e.error.info});t(e,g)}).catch(function(e){return console.error((e.code||"")+" "+e.message+" "+e.stack+")")})}function o(e){var r=[];if(e.childNodes){var t=[],n=[];e.childNodes.forEach(function(e,o,a){e.classList.contains("--slide-from-top")?r[o]=new Promise(function(r,t){var a=setTimeout(function(){clearTimeout(n.shift()),e.classList.remove("--slide-from-top"),r("Ok")},30*o);n.push(a)}):r[o]=new Promise(function(r,n){var i=setTimeout(function(){clearTimeout(t.pop()),e.classList.add("--slide-to-bottom");var n=setTimeout(function(){clearTimeout(n),e.classList.remove("--slide-to-bottom")},300);r("Ok")},10*(a.length-o));t.push(i)})})}else r=[];return r}function a(e){var r=document.location.href,t=document.title;console.log("Inside saveState() searchValue is "+h.value),window.history.replaceState({searchValue:h.value,pageTitle:t},"",r),window.history.pushState({searchValue:h.value,pageTitle:t,pageId:e},"",r)}function i(e){var r=e.pageid,t=e.title,o=document.createElement("div"),i=document.createElement("h2");i.innerHTML=t,i.classList.add("media-box__title"),o.appendChild(i);var s=document.createElement("div");if(e.thumbnail){var c=e.thumbnail.source,u=e.thumbnail.width,l=e.thumbnail.height,d=document.createElement("img");d.src=c,d.height=l,d.width=u,d.classList.add("media-box__image"),s.appendChild(d)}if(e.terms){var p=e.terms.description[0],h=document.createElement("p");h.innerHTML=p,h.classList.add("media-box__text"),s.appendChild(h)}o.classList.add("media-box"),o.classList.add("--slide-from-top"),s.classList.add("media-box__container"),o.appendChild(s),g.appendChild(o),o.addEventListener("click",function(){a(r),n(r)})}function s(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,t="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?\n        action=query&\n        format=json&\n        generator=prefixsearch&\n        prop=pageprops%7Cpageimages%7Cpageterms&\n        redirects=&\n        ppprop=displaytitle&\n        piprop=thumbnail&\n        pithumbsize=80&\n        pilimit="+r+"&\n        wbptterms=description&\n        gpssearch="+e+"&\n        gpsnamespace=0&\n        gpslimit="+r+"&\n        origin=*",n=new Headers;return n.append("Api-User-Agent","Example/1.0"),fetch(t,{headers:n}).then(function(r){if(r.ok)return r.json();throw new Error("Could not get the Wikipage for "+e+"!")}).then(function(r){if(r.error)throw console.warn(r.error.info),new Error({code:r.error.code,message:r.error.info});if(r.query&&r.query.pages)return r.query.pages||r.query.search;throw console.warn(r.query),new Error({code:"NoSuchPage",message:"There is no pages for "+e})}).catch(function(e){return Promise.reject(e)})}function c(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function u(e){return e.replace(/([.,;:=+[\]\\|\/?<>!@#$%\^\&*()'"\n\r])/g,"")}function l(){var e=u(h.value);Promise.all([s(e)].concat(_toConsumableArray(o(g)))).then(function(e){return c(g),e[0]}).then(function(e){Object.keys(e).forEach(function(r){i(e[r],g)})}).then(function(){o(g)})}var d=document.querySelector(".search"),p=document.querySelector("#searchBtnRandom"),h=document.querySelector("#searchInput"),g=document.querySelector(".external__data"),m=function(e,r){for(var t=arguments.length,n=Array(t>2?t-2:0),o=2;o<t;o++)n[o-2]=arguments[o];var a=this,i=void 0;return function(){var t=a;clearTimeout(i),i=setTimeout(function(){i=null,e.apply(t,n)},r)}}(l,250,!1),f=["Meta","Alt","CapsLock","Shift","Control","Tab","Escape","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12"];window.onpopstate=function(e){e.state.searchValue&&(console.log(e.state),c(g),h.value=e.state.searchValue,document.title=e.state.pageTitle,e.state.pageId?(console.log(e.state.pageId),n(e.state.pageId)):(l?console.log("searchPhrase exists"):console.log("searchPhrase doesn't exists"),l()))},d.addEventListener("submit",function(e){return e.preventDefault(),!1}),p.addEventListener("click",function(){var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?\n        action=query&\n        format=json&\n        generator=random&\n        origin=*",t=new Headers;return t.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:t}).then(function(e){if(e.ok)return e.json();throw new Error("Could not get a random Wikipage!")}).then(function(e){if(e.error)throw console.warn(e.error.info),new Error({code:e.error.code,message:e.error.info});if(e.query&&e.query.pages)return e.query.pages;throw console.warn(e.query),new Error({code:"NoSuchPage",message:"There is no pages found"})}).then(function(r){var t=Object.keys(r)[0];e(),a(t),n(t)}).catch(function(e){return Promise.reject(e)})}),h.addEventListener("keyup",function(e){console.log(e),f.includes(e.key)||m()}),h.addEventListener("keyup",function(e){f.includes(e.key)||r()}),h.addEventListener("keyup",e)}();
//# sourceMappingURL=script.js.map
