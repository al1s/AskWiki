"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function showPage(e,n){var t=navigator.language||navigator.userLanguage;n.innerHTML=e.parse.text["*"]||e.parse.text;for(var r=document.querySelectorAll("a"),o=0,a=r.length;o<a;o++)/wiki|w/g.test(r[o].pathname)&&(r[o].host=t+".wikipedia.org",r[o].port=443)}function getWikiPage(e){var n="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?action=parse&format=json&formatversion=2&pageid="+e+"&origin=*",t=new Headers;t.append("Api-User-Agent","Example/1.0"),fetch(n,{headers:t}).then(function(n){if(n.ok)return n.json();throw new Error("Error while retrieving page with id "+e)}).then(function(e){if(e.error)throw console.warn(e.error.info),{code:e.error.code,message:e.error.info};showPage(e,document.querySelector(".external__data"))}).catch(function(e){return console.error((e.code||"")+" "+e.message+" "+e.stack+")")})}function slideIn(e){if(e.childNodes){var n=[],t=[],r=[];return e.childNodes.forEach(function(e,o,a){e.classList.contains("--slide-from-top")?(console.log("slideIn:, cycle="+cycle+", move '"+e.firstChild.innerHTML+"' from top"),r[o]=new Promise(function(n,r){var a=setTimeout(function(){clearTimeout(t.shift()),e.classList.remove("--slide-from-top"),n("Ok")},30*o);t.push(a)})):(console.log("slideIn:, cycle="+cycle+", move '"+e.firstChild.innerHTML+"' to bottom"),r[o]=new Promise(function(t,r){var i=setTimeout(function(){clearTimeout(n.pop()),e.classList.add("--slide-to-bottom");var r=setTimeout(function(){clearTimeout(r),e.classList.remove("--slide-to-bottom")},300);t("Ok")},30*(a.length-o));n.push(i)}))}),r}}function showData(e,n){var t=e.pageid,r=e.title,o=document.createElement("div"),a=document.createElement("h2");a.innerHTML=r,a.classList.add("media-box__title"),o.appendChild(a);var i=document.createElement("div");if(e.thumbnail){var c=e.thumbnail.source,s=e.thumbnail.width,l=e.thumbnail.height,d=document.createElement("img");d.src=c,d.height=l,d.width=s,i.appendChild(d)}if(e.terms){var u=e.terms.description[0],h=document.createElement("p");h.innerHTML=u,h.classList.add("media-box__text"),i.appendChild(h)}o.classList.add("media-box"),o.classList.add("--slide-from-top"),i.classList.add("media-box__container"),o.appendChild(i),n.appendChild(o),o.addEventListener("click",function(){getWikiPage(t)})}function searchWikiData(e){return new Promise(function(n,t){document.querySelector(".external__data");var r="https://"+(navigator.language||navigator.userLanguage)+".wikipedia.org/w/api.php?\n        action=query&\n        format=json&\n        generator=prefixsearch&\n        prop=pageprops%7Cpageimages%7Cpageterms&\n        redirects=&\n        ppprop=displaytitle&\n        piprop=thumbnail&\n        pithumbsize=80&\n        pilimit=6&\n        wbptterms=description&\n        gpssearch="+e+"&\n        gpsnamespace=0&\n        gpslimit=6&\n        origin=*",o=new Headers;o.append("Api-User-Agent","Example/1.0"),fetch(r,{headers:o}).then(function(n){if(console.log("fetched data for cycle="+cycle),n.ok)return n.json();throw new Error("Could not get the Wikipage for "+e+"!")}).then(function(t){if(t.error)throw console.warn(t.error.info),{code:t.error.code,message:t.error.info};if(!t.query||!t.query.pages)throw console.warn(t.query),{code:"NoSuchPage",message:"There is no pages for "+e};n(t.query.pages||t.query.search)}).catch(function(e){return t(e)})})}function clearData(e){for(;e.firstChild;)console.log("removal: cycle="+cycle+", elm is "+e.firstChild.firstChild.innerHTML),e.removeChild(e.firstChild)}function cleanInput(e){return e.replace(/([.,;:=+[\]\\|\/?<>!@#$%\^\&*()'"\n\r])/g,"")}function searchPhrase(){var e=document.querySelector(".external__data"),n=cleanInput(document.querySelector("#searchInput").value);console.group("Cycle_"+cycle),console.log("First slideIn, searchPhrase cleaning phase for cycle="+cycle),Promise.all([searchWikiData(n)].concat(_toConsumableArray(slideIn(e)))).then(function(n){return clearData(e),n[0]}).then(function(n){Object.keys(n).forEach(function(t){showData(n[t],e)})}).then(function(){console.log("Second slideIn inside searchWikiData for cycle="+cycle),slideIn(e)}),console.groupEnd("Cycle_"+cycle)}function searchRandom(){}function delayMethod(e,n,t){void 0===window.delayMethod&&(window.delayMethod={}),delayMethod[e]=Date.now(),console.log(""+delayMethod[e]);var r=delayMethod[e];setTimeout(function(){delayMethod[e]===r&&n()},t||500)}function debounce(e,n){var t=void 0;return function(){var r=this,o=arguments;clearTimeout(t),t=setTimeout(function(){t=null,e.apply(r,o)},n)}}var submitBtnElm=document.querySelector("#searchBtnSubmit"),randomBtnElm=document.querySelector("#searchBtnRandom"),inputElm=document.querySelector("#searchInput"),cycle=1,delayFnOnInput=debounce(searchPhrase,250,!1);submitBtnElm.addEventListener("click",searchPhrase),randomBtnElm.addEventListener("click",searchRandom),inputElm.addEventListener("keyup",function(e){console.log(e.target.value),delayFnOnInput(),cycle++});
//# sourceMappingURL=script.js.map
